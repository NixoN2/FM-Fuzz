name: CVC5 Commit Coverage Analysis

on:
  workflow_dispatch:

jobs:
  commit-coverage-analysis:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v5
      
      - name: Build CVC5 with coverage
        run: |
          ./scripts/cvc5/build.sh --coverage
      
      - name: Download coverage mapping artifact
        uses: actions/download-artifact@v4
        with:
          name: coverage-mapping-final
          path: .
      
      - name: Extract coverage mapping
        run: |
          gunzip coverage_mapping_merged.json.gz
          ls -la coverage_mapping_merged.json
      
      - name: Install Python dependencies
        run: |
          pip install gitpython unidiff libclang
      
      - name: Run commit coverage analysis
        run: |
          ./scripts/cvc5/run_commit_coverage_analysis.sh 10
